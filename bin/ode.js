var extras=extras||{};extras.createObject=function(a){var b=function(){};b.prototype=a;return new b};extras.inherits=function(a,b){var c=extras.createObject(b.prototype);a.parentClass_=b;c.constructor=a;a.prototype=c};extras.base=function(a){var b=arguments.callee.caller;if(b.parentClass_)return b.parentClass_.apply(a,Array.prototype.slice.call(arguments,1));return null};
extras.range=function(a,b,c){var d=[],c=c||1,e=!1;typeof a==="number"&&typeof b==="number"||(typeof a==="string"&&typeof b==="string"?(e=!0,a=a.charCodeAt(0),b=b.charCodeAt(0)):(a=isNaN(a)?0:parseInt(a,10),b=isNaN(b)?0:parseInt(b,10)));if(a>b)for(;a>=b;)d.push(e?String.fromCharCode(a):a),a-=c;else for(;a<=b;)d.push(e?String.fromCharCode(a):a),a+=c;return d};extras.isBetween=function(a,b,c){return a<=b&&b<=c};extras.isInteger=function(a){return Math.floor(a)===a?!0:!1};
extras.isArray=function(a){return a instanceof Array};extras.hasInstances=function(a){if(arguments.length===1)throw new TypeError;var b;for(b=1;b<arguments.length;b++)if(!(arguments[b]instanceof a))return!1;return!0};extras.mapMethod=function(a,b){var c=a.length;if(typeof b!=="string")throw new TypeError;var d=Array(c),e;for(e=0;e<c;e++)e in a&&(d[e]=a[e][b]());return d};extras.contains=function(a,b){var c=a.length,d;for(d=0;d<c;d++)if(a[d]===b)return!0;return!1};
extras.containsAny=function(a,b){if(extras.isArray(b)){var c;for(c=0;c<b.length;c++)if(extras.contains(a,b[c]))return!0}else throw new TypeError;return!1};extras.keys=function(a){if(a!==Object(a))throw new TypeError("extras.keys called on non-object");var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b};
extras.each=function(a,b){if(a===void 0||a===null)throw new TypeError;var c=Object(a),d=c.length>>>0;if(typeof b!=="function")throw new TypeError;for(var e=0;e<d;e++)e in c&&b.call(null,c[e],e,c)};extras.bind=function(a,b){if(arguments.length>2){var c=Array.prototype.slice.call(arguments,2);return function(){var d=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(d,c);return a.apply(b,d)}}else return function(){return a.apply(b,arguments)}};
extras.withoutElement=function(a,b){var c=a.indexOf(b);return a.slice(0,c).concat(a.slice(c+1))};extras.reverseArray=function(a){a=a.slice();a.reverse();return a};var ode=ode||{};ode.LexingException=function(a){this.toString=function(){return"Unexpected character <"+a+"> with code "+a.charCodeAt(0)}};ode.ParsingException=function(a){this.toString=function(){return a}};ode.RuntimeException=function(a){this.toString=function(){return a}};ode.RuntimeConversionException=function(a,b,c){extras.base(this,"Cannot convert "+c.toString()+" from "+a+" to "+b)};extras.inherits(ode.RuntimeConversionException,ode.RuntimeException);
ode.RuntimeStackException=function(a){extras.base(this,a)};extras.inherits(ode.RuntimeStackException,ode.RuntimeException);ode.RuntimeCustomException=function(){extras.base(this,"Custom exception thrown by program")};extras.inherits(ode.RuntimeCustomException,ode.RuntimeException);ode.TailCallbackException=function(){this.toString=function(){return"Tail callback exception"}};ode.TokenType={OPEN_LIST:"open list",CLOSE_LIST:"close list",OPEN_SET:"open set",CLOSE_SET:"close set",STRING:"string",SEMICOLON:"semicolon",EQUALS:"equals",SYMBOL:"symbol",NUMBER:"number",CHARACTER:"character"};ode.Token=function(a,b,c){this.getType=function(){return a};this.getRepr=function(){return b};this.getVal=function(){return c};this.toString=function(){return"Token<"+a+","+b+","+c+">"}};
ode.Lexer=function(a){function b(a){return extras.contains(extras.range("A","Z"),a)||extras.contains(extras.range("a","z"),a)||extras.contains(n,a)}function c(a){return b(a)||d(a)||extras.contains(["="],a)}function d(a){return extras.contains(extras.range("0","9"),a)}function e(a){return d(a)||extras.contains(["e","E","."],a)}function f(a){return a==='"'}function h(){if(g<a.length){var c=a.charAt(g);if(c==="-")return c=a.charAt(g+1),d(c)?i():l();if(c==="=")return a.charAt(g+1)==="="?(g+=2,new ode.Token(ode.TokenType.EQUALS,
"==")):l();else if(c==="'")return c="",g++,c=a.charAt(g),g++,new ode.Token(ode.TokenType.CHARACTER,"'"+c,c);else if(c==='"'){c="";for(g++;g<a.length&&!f(a.charAt(g));)c+=a.charAt(g),g+=1;g++;return new ode.Token(ode.TokenType.STRING,'"'+c+'"',c)}else if(b(c))return l();else if(d(c))return i();else if(extras.contains([" ","\t","\n"],c))return g+=1,h();else switch(c){case "[":return j(new ode.Token(ode.TokenType.OPEN_LIST,"["));case "]":return j(new ode.Token(ode.TokenType.CLOSE_LIST,"]"));case "{":return j(new ode.Token(ode.TokenType.OPEN_SET,
"{"));case "}":return j(new ode.Token(ode.TokenType.CLOSE_SET,"}"));case ";":return j(new ode.Token(ode.TokenType.SEMICOLON,";"));default:throw new ode.LexingException(c);}}else return null}function i(){var b="";a.charAt(g)==="-"&&(b+="-",g+=1);for(;g<a.length&&e(a.charAt(g));)b+=a.charAt(g),g+=1;return new ode.Token(ode.TokenType.NUMBER,b,parseFloat(b))}function l(){for(var b="";g<a.length&&c(a.charAt(g));)b+=a.charAt(g),g+=1;return new ode.Token(ode.TokenType.SYMBOL,b)}function j(a){g+=1;return a}
var m=[],k=0,g=0;this.getInput=function(){return a};this.getCurrent=function(){k>=m.length&&m.push(h());return m[k]};this.movePrev=function(){k-=1};this.moveNext=function(){k+=1};var n=["+","-",".","<",">","*","/","#","?","$","!","="]};ode.Node=function(){};ode.NestableNode=function(a){extras.base(this);this.typeName_=a};extras.inherits(ode.NestableNode,ode.Node);ode.NestableNode.prototype.getTypeName=function(){return this.typeName_};ode.AtomicNode=function(a,b){extras.base(this,b);this.val=a};extras.inherits(ode.AtomicNode,ode.NestableNode);ode.AtomicNode.prototype.toString=function(){return this.val.toString()};ode.SymbolNode=function(a){extras.base(this,a,"symbol")};extras.inherits(ode.SymbolNode,ode.AtomicNode);
ode.SymbolNode.prototype.getName=function(){return this.val.toString()};ode.BooleanNode=function(a){extras.base(this,a,"logical")};extras.inherits(ode.BooleanNode,ode.AtomicNode);ode.BooleanNode.prototype.toString=function(){return this.val?"true":"false"};ode.BooleanNode.prototype.toBooleanValue=function(){return this.val?!0:!1};ode.CharacterNode=function(a){extras.base(this,a,"char")};extras.inherits(ode.CharacterNode,ode.AtomicNode);ode.CharacterNode.prototype.toString=function(){return"'"+this.val};
ode.NumberNode=function(a){extras.base(this,a,"number")};extras.inherits(ode.NumberNode,ode.AtomicNode);ode.NumberNode.prototype.toString=function(){return Math.floor(this.val)===this.val?Math.floor(this.val).toString():this.val.toString()};ode.NumberNode.prototype.toBooleanValue=function(){if(this.val===0)return!1;else if(this.val===1)return!0;else throw new ode.RuntimeConversionException("number","boolean",this.val);};ode.NumberNode.prototype.toNumberValue=function(){return parseFloat(this.val.toString())};
ode.AggregateNode=function(a,b){extras.base(this,b);this.nodes_=a};extras.inherits(ode.AggregateNode,ode.NestableNode);ode.AggregateNode.prototype.getSize=function(){return this.nodes_.length};ode.AggregateNode.prototype.getNodes=function(){return this.nodes_};ode.AggregateNode.prototype.getFirst=function(){return this.nodes_[0]};ode.AggregateNode.prototype.getRest=function(){return new this.constructor(this.nodes_.slice(1),this.typeName_)};ode.ListNode=function(a){extras.base(this,a,"list")};
extras.inherits(ode.ListNode,ode.AggregateNode);ode.ListNode.prototype.toString=function(){return this.nodes_.length>0?"["+extras.mapMethod(this.nodes_,"toString").join(" ")+"]":"[]"};ode.ListNode.prototype.concatenate=function(a){return new ode.ListNode(this.nodes_.concat(a.getNodes()))};ode.ListNode.prototype.canConcatenateWith=function(a){return a.getNodes?!0:!1};ode.ListNode.prototype.prependNode=function(a){return new ode.ListNode([a].concat(this.nodes_))};
ode.ListNode.prototype.canPrependNode=function(a){return a instanceof ode.NestableNode};ode.SetNode=function(a){extras.base(this,a,"set")};extras.inherits(ode.SetNode,ode.AggregateNode);ode.SetNode.prototype.toString=function(){return this.nodes_.length>0?"{"+extras.mapMethod(this.nodes_,"toString").join(" ")+"}":"{}"};ode.StringNode=function(a){extras.base(this,null,"string");this.val=a};extras.inherits(ode.StringNode,ode.AggregateNode);
ode.StringNode.prototype.toString=function(){return this.val.length>0?'"'+this.val+'"':'""'};ode.StringNode.prototype.getSize=function(){return this.val.length};ode.StringNode.prototype.concatenate=function(a){return new ode.StringNode(this.val+a.val)};ode.StringNode.prototype.canConcatenateWith=function(a){return a instanceof ode.StringNode};ode.StringNode.prototype.prependNode=function(a){return new ode.StringNode(a.val+this.val)};
ode.StringNode.prototype.canPrependNode=function(a){return a instanceof ode.CharacterNode};ode.StringNode.prototype.getNodes=function(){var a,b=[];for(a=0;a<this.val.length;a++)b.push(new ode.CharacterNode(this.val.charAt(a)));return b};ode.StringNode.prototype.getFirst=function(){return new ode.CharacterNode(this.val.charAt(0))};ode.StringNode.prototype.getRest=function(){return new this.constructor(this.val.slice(1))};ode.StatementNode=function(){extras.base(this)};
extras.inherits(ode.StatementNode,ode.Node);ode.PhraseStatementNode=function(a){extras.base(this);this.nodes_=a};extras.inherits(ode.PhraseStatementNode,ode.StatementNode);ode.PhraseStatementNode.prototype.toString=function(){return extras.mapMethod(this.nodes_,"toString").join(" ")};ode.PhraseStatementNode.prototype.getNodes=function(){return this.nodes_};ode.DefinitionStatementNode=function(a,b){extras.base(this);this.name=a;this.body=b};extras.inherits(ode.DefinitionStatementNode,ode.StatementNode);
ode.DefinitionStatementNode.prototype.toString=function(){return this.name+" = "+this.body.toString()+";"};ode.ProgramNode=function(a){extras.base(this);this.statements=a};extras.inherits(ode.ProgramNode,ode.Node);ode.ProgramNode.prototype.toString=function(){return extras.mapMethod(this.statements,"toString").join("; ")};ode.Parser=function(){function a(a){for(var c=[],f=!0;a.getCurrent()!==null&&f;){var h=a.getCurrent();h&&h.getType()===ode.TokenType.SEMICOLON?(a.moveNext(),f=!1):(c.push(b(a)),a.moveNext())}return new ode.PhraseStatementNode(c)}function b(a){var e=a.getCurrent();if(e)switch(e.getType()){case ode.TokenType.OPEN_LIST:case ode.TokenType.OPEN_SET:case ode.TokenType.STRING:a:{if(e=a.getCurrent())switch(e.getType()){case ode.TokenType.OPEN_LIST:a.moveNext();for(var e=[],f=!0;a.getCurrent()!==null&&f;){var h=
a.getCurrent();h&&h.getType()===ode.TokenType.CLOSE_LIST?f=!1:(e.push(b(a)),a.moveNext())}a=new ode.ListNode(e);break a;case ode.TokenType.OPEN_SET:a.moveNext();e=[];for(f=!0;a.getCurrent()!==null&&f;)(h=a.getCurrent())&&h.getType()===ode.TokenType.CLOSE_SET?f=!1:(e.push(c(a)),a.moveNext());a=new ode.SetNode(e);break a;case ode.TokenType.STRING:a=a.getCurrent();a=new ode.StringNode(a.getVal());break a}break}return a;case ode.TokenType.SYMBOL:case ode.TokenType.NUMBER:case ode.TokenType.CHARACTER:return c(a);
case ode.TokenType.CLOSE_LIST:case ode.TokenType.CLOSE_SET:throw new ode.ParsingException("Unbalanced brackets");case ode.TokenType.SEMICOLON:throw new ode.ParsingException("Unexpected end of statement");case ode.TokenType.EQUALS:throw new ode.ParsingException("Only a name can appear before '=' in a definition");}throw new ode.ParsingException("Unexpected token: "+a.getCurrent().getRepr());}function c(a){var b=a.getCurrent();if(b)switch(b.getType()){case ode.TokenType.SYMBOL:return b=a.getCurrent(),
b.getRepr()==="true"?new ode.BooleanNode(!0):b.getRepr()==="false"?new ode.BooleanNode(!1):new ode.SymbolNode(a.getCurrent().getRepr());case ode.TokenType.NUMBER:return new ode.NumberNode(a.getCurrent().getVal());case ode.TokenType.CHARACTER:return new ode.CharacterNode(a.getCurrent().getVal())}throw new ode.ParsingException("Unexpected token: "+a.getCurrent().getRepr());}this.parse=function(a){for(var b=[];a.getCurrent()!==null;)b.push(this.parseStatement(a));return new ode.ProgramNode(b)};this.parseStatement=
function(b){var c=b.getCurrent();if(c&&c.getType()===ode.TokenType.SYMBOL)if(b.moveNext(),(c=b.getCurrent())&&c.getType()===ode.TokenType.EQUALS){b.movePrev();if((c=b.getCurrent())&&c.getType()===ode.TokenType.SYMBOL){c=b.getCurrent().getRepr();b.moveNext();var f=ode.TokenType.EQUALS,h=b.getCurrent();if(h&&h.getType()===f)b.moveNext();else throw new ode.ParsingException("Unexpected token. Expected: =; Actual: "+b.getCurrent().getRepr());b=new ode.DefinitionStatementNode(c,a(b))}else throw new ode.ParsingException("Unexpected token in definition: "+
b.getCurrent().getRepr());return b}else return b.movePrev(),a(b);else return a(b)}};ode.AbstractDefinitionBody=function(){};ode.NativeDefinitionBody=function(a){extras.base(this);this.nativeFunction=a};extras.inherits(ode.NativeDefinitionBody,ode.AbstractDefinitionBody);ode.CustomDefinitionBody=function(a){extras.base(this);this.phraseNode=a};extras.inherits(ode.CustomDefinitionBody,ode.AbstractDefinitionBody);ode.SymbolTable=function(){this.natives={};this.customs={}};
ode.SymbolTable.prototype.set=function(a,b){if(b instanceof ode.CustomDefinitionBody)this.customs[a]=b;else if(b instanceof ode.NativeDefinitionBody)this.natives[a]=b;else throw new ode.RuntimeException("Symbol Table does not recognize definition type");};ode.SymbolTable.prototype.drop=function(a){if(this.customs[a])delete this.customs[a];else if(this.natives[a])throw new ode.RuntimeException("Cannot drop native definitions");else throw new ode.RuntimeException("No definition found to drop");};
ode.SymbolTable.prototype.get=function(a){return this.customs[a]?this.customs[a]:this.natives[a]};ode.SymbolTable.prototype.emptyCustomDefinitions=function(){this.customs={}};ode.SymbolTable.prototype.toString=function(){var a="";extras.each([this.natives,this.customs],function(b){extras.each(extras.keys(b),function(c){a+=c+" = ";c=b[c];a+=c instanceof ode.CustomDefinitionBody?c.phraseNode.toString():c instanceof ode.NativeDefinitionBody?"<native definition>":"<unknown>";a+=";\n"})});return a};
ode.SymbolTable.prototype.stringifyCustomDefinitions=function(a){var b=[],c=this.customs;extras.each(extras.keys(this.customs),function(a){var e=c[a];e instanceof ode.CustomDefinitionBody&&b.push(a+" = "+e.phraseNode.toString()+";")});return b.join(a)};ode.RuntimeStack=function(){var a=[];this.top=function(){if(a.length===0)throw new ode.RuntimeStackException("Stack empty");return a[a.length-1]};this.pop=function(){if(a.length===0)throw new ode.RuntimeStackException("Stack empty");return a.pop()};this.push=function(b){if(a.length>5E3)throw new ode.RuntimeStackException("Stack has reached limit of 5000 items; Operation terminated");a.push(b)};this.drop=function(b){if(!extras.isBetween(0,b,a.length-1))throw new ode.RuntimeStackException("Attempted drop outside of stack bounds; stack size = "+
a.length+"; position = "+b.toString());if(!extras.isInteger(b))throw new ode.RuntimeStackException("Drop expects non-negative integer, got: "+b.toString());a.splice(a.length-1-b,1)};this.duplicate=function(b){if(!extras.isBetween(0,b,a.length-1))throw new ode.RuntimeStackException("Attempted duplication outside of stack bounds; stack size = "+a.length+"; position = "+b.toString());if(!extras.isInteger(b))throw new ode.RuntimeStackException("Duplication expects non-negative integer, got: "+b.toString());
a.push(a[a.length-1-b])};this.moveToTop=function(b){if(b>a.length)throw new ode.RuntimeStackException("Attempted to move item outside of stack bounds; stack size = "+a.length+"; number to rotate = "+b+1);a.push(a.splice(a.length-1-b,1)[0])};this.empty=function(){a=[]};this.toString=function(){return extras.mapMethod(a,"toString").join(" ")};this.getInternalArray=function(){return a};this.setInternalArray=function(b){a=b}};
ode.FrameStack=function(){var a=[];this.push=function(b){a.push(b)};this.top=function(){if(a.length===0)throw new ode.RuntimeStackException("Frame stack empty; Cannot get top");return a[a.length-1]};this.pop=function(){if(a.length===0)throw new ode.RuntimeStackException("Frame stack empty; Cannot pop");return a.pop()};this.dropAllChildFrames=function(){for(;a.length>1;)this.pop()};this.getLength=function(){return a.length}};ode.Environment=function(a,b,c,d,e){this.symbolTable=b;this.print=c;this.runNestableNodes=d;this.runCreateList=e;this.frames_=new ode.FrameStack;this.stack_=a;this.frames_.push(this.stack)};ode.Environment.prototype.enterFrame=function(){this.frames_.push(new ode.RuntimeStack);this.stack_=this.frames_.top()};ode.Environment.prototype.exitFrame=function(){this.frames_.pop();this.stack_=this.frames_.top()};
ode.Environment.prototype.resetFrames=function(){this.frames_.dropAllChildFrames();this.stack_=this.frames_.top()};ode.Environment.prototype.getStackNodes=function(){return this.stack_.getInternalArray()};ode.Environment.prototype.setStackNodes=function(a){this.stack_.setInternalArray(a)};ode.Environment.prototype.pop=function(){return this.stack_.pop()};ode.Environment.prototype.drop=function(a){this.stack_.drop(a)};ode.Environment.prototype.duplicate=function(a){this.stack_.duplicate(a)};
ode.Environment.prototype.moveToTop=function(a){this.stack_.moveToTop(a)};ode.Environment.prototype.push=function(a){this.stack_.push(a)};ode.Environment.prototype.emptyStack=function(){this.stack_.empty()};ode.Environment.prototype.expectationError=function(a,b,c){b=extras.isArray(b)?b.join(","):b;c=extras.mapMethod(c,"toString").join(",");throw new ode.RuntimeException("Operation <"+a+"> expected <"+b+"> but got <"+c+">");};ode.Interpreter=function(a,b,c){this.e=new ode.Environment(a,b,c,extras.bind(this.runNestableNodes,this),extras.bind(this.runCreateList,this))};ode.Interpreter.prototype.run=function(a){var b=this;extras.each(a.statements,function(a){try{if(a instanceof ode.DefinitionStatementNode)b.runDefinition(a);else if(a instanceof ode.PhraseStatementNode)b.runPhrase(a,0);else throw new ode.RuntimeException("Unrecognized statement: <"+a.toString()+">");}catch(d){throw b.e.resetFrames(),d;}})};
ode.Interpreter.prototype.runPhrase=function(a,b){if(b>100)throw new ode.RuntimeException("Possible infinite recursion detected; Operation terminated");this.runNestableNodes(a.getNodes(),b)};
ode.Interpreter.prototype.runNestableNodes=function(a,b){var c=this,d=b||0;extras.each(a,function(a){if(a instanceof ode.ListNode)c.runList(a);else if(a instanceof ode.SetNode)c.runSet(a);else if(a instanceof ode.StringNode)c.runString(a.val);else if(a instanceof ode.SymbolNode)c.runSymbol(a.val,d);else if(a instanceof ode.NumberNode)c.runNumber(a.val);else if(a instanceof ode.BooleanNode)c.runBoolean(a.val);else if(a instanceof ode.CharacterNode)c.runCharacter(a.val);else throw new ode.RuntimeException("Unrecognized nested node: <"+
a.toString()+">");})};ode.Interpreter.prototype.runDefinition=function(a){this.e.symbolTable.set(a.name,new ode.CustomDefinitionBody(a.body))};ode.Interpreter.prototype.runList=function(a){this.e.stack.push(a)};ode.Interpreter.prototype.runSet=function(a){this.e.stack.push(a)};ode.Interpreter.prototype.runString=function(a){this.e.stack.push(new ode.StringNode(a))};ode.Interpreter.prototype.runNumber=function(a){this.e.stack.push(new ode.NumberNode(a))};ode.Interpreter.prototype.runBoolean=function(a){this.e.stack.push(new ode.BooleanNode(a))};
ode.Interpreter.prototype.runCharacter=function(a){this.e.stack.push(new ode.CharacterNode(a))};
ode.Interpreter.prototype.runSymbol=function(a,b){var c=this.e.symbolTable.get(a);if(c instanceof ode.CustomDefinitionBody)for(;;){try{this.runPhrase(c.phraseNode,b+1)}catch(d){if(d instanceof ode.TailCallbackException)continue;else throw d;}break}else if(c instanceof ode.NativeDefinitionBody)c.nativeFunction(this.e);else if(a==="self")throw new ode.TailCallbackException;else throw new ode.RuntimeException("Undefined symbol: "+a);};
ode.Interpreter.prototype.runCreateList=function(a){var b=this,c=[];a>0&&extras.each(extras.range(a-1),function(){c.unshift(b.e.stack.pop())});this.e.stack.push(new ode.ListNode(c))};ode.Interpreter.prototype.addNativeOperation=function(a,b){this.e.symbolTable.set(a,new ode.NativeDefinitionBody(b))};ode.joynatives=ode.joynatives||{};
ode.joynatives.initialize=function(a){a.addNativeOperation("body",ode.joynatives.body);a.addNativeOperation("name",ode.joynatives.name);a.addNativeOperation("intern",ode.joynatives.intern);a.addNativeOperation("ifte",ode.joynatives.ifte);a.addNativeOperation("pred",ode.joynatives.pred);a.addNativeOperation("succ",ode.joynatives.succ);a.addNativeOperation("div",ode.joynatives.div);a.addNativeOperation("rem",ode.joynatives.rem);a.addNativeOperation("+",ode.joynatives.makeMathOperator("+","+"));a.addNativeOperation("-",
ode.joynatives.makeMathOperator("-","-"));a.addNativeOperation("*",ode.joynatives.makeMathOperator("*","*"));a.addNativeOperation("/",ode.joynatives.makeMathOperator("/","/"));a.addNativeOperation("rand",ode.joynatives.rand);a.addNativeOperation("and",ode.joynatives.and);a.addNativeOperation("or",ode.joynatives.or);a.addNativeOperation("xor",ode.joynatives.xor);a.addNativeOperation("not",ode.joynatives.not);a.addNativeOperation("choice",ode.joynatives.choice);a.addNativeOperation("<",ode.joynatives.makeComparisonOp("<",
"<"));a.addNativeOperation(">",ode.joynatives.makeComparisonOp(">",">"));a.addNativeOperation("<=",ode.joynatives.makeComparisonOp("<=","<="));a.addNativeOperation(">=",ode.joynatives.makeComparisonOp(">=",">="));a.addNativeOperation("=",ode.joynatives.makeComparisonOp("===","="));a.addNativeOperation("!=",ode.joynatives.makeComparisonOp("!==","!="));a.addNativeOperation("null",ode.joynatives.nullPredicate);a.addNativeOperation("small",ode.joynatives.small);a.addNativeOperation("integer",ode.joynatives.integer);
a.addNativeOperation("float",ode.joynatives.floatPredicate);a.addNativeOperation("string",ode.joynatives.string);a.addNativeOperation("char",ode.joynatives.charPredicate);a.addNativeOperation("list",ode.joynatives.list);a.addNativeOperation("set",ode.joynatives.set);a.addNativeOperation("logical",ode.joynatives.logical);a.addNativeOperation("concat",ode.joynatives.concat);a.addNativeOperation("size",ode.joynatives.size);a.addNativeOperation("cons",ode.joynatives.cons);a.addNativeOperation("uncons",
ode.joynatives.uncons);a.addNativeOperation("i",ode.joynatives.i);a.addNativeOperation("first",ode.joynatives.first);a.addNativeOperation("rest",ode.joynatives.rest);a.addNativeOperation("swons",ode.joynatives.swons);a.addNativeOperation("id",function(){});a.addNativeOperation("dup",ode.joynatives.dup);a.addNativeOperation("dupd",ode.joynatives.dupd);a.addNativeOperation("swap",ode.joynatives.swap);a.addNativeOperation("rollup",ode.joynatives.makeRotationOp([2,2]));a.addNativeOperation("rolldown",
ode.joynatives.makeRotationOp([2]));a.addNativeOperation("rotate",ode.joynatives.makeRotationOp([1,2]));a.addNativeOperation("popd",function(a){a.drop(1)});a.addNativeOperation("swapd",ode.joynatives.makeRotationOp([2,1]));a.addNativeOperation("rollupd",ode.joynatives.makeRotationOp([3,3,2]));a.addNativeOperation("rolldownd",ode.joynatives.makeRotationOp([3,1]));a.addNativeOperation("rotated",ode.joynatives.makeRotationOp([2,3,2]));a.addNativeOperation("pop",ode.joynatives.pop);a.addNativeOperation("dip",
ode.joynatives.dip);a.addNativeOperation("newstack",ode.joynatives.newstack);a.addNativeOperation("stack",ode.joynatives.stack);a.addNativeOperation("unstack",ode.joynatives.unstack);a.addNativeOperation("infra",ode.joynatives.infra);a.addNativeOperation("unary",ode.joynatives.makeUnary("unary",1));a.addNativeOperation("unary2",ode.joynatives.makeUnary("unary2",2));a.addNativeOperation("unary3",ode.joynatives.makeUnary("unary3",3));a.addNativeOperation("unary4",ode.joynatives.makeUnary("unary4",4));
a.addNativeOperation("primrec",ode.joynatives.primrec);a.addNativeOperation("genrec",ode.joynatives.genrec);a.addNativeOperation("linrec",ode.joynatives.linrec);a.addNativeOperation("binrec",ode.joynatives.binrec);a.addNativeOperation("split",ode.joynatives.split);a.addNativeOperation(".",ode.joynatives.print);a.addNativeOperation("dup#",ode.joynatives.dupLocation);a.addNativeOperation("drop#",ode.joynatives.dropLocation);a.addNativeOperation("number?",ode.joynatives.numberPredicate);a.addNativeOperation("block?",
ode.joynatives.blockPredicate);a.addNativeOperation("empty?",ode.joynatives.emptyPredicate);a.addNativeOperation("$type",ode.joynatives.type);a.addNativeOperation("def",ode.joynatives.def);a.addNativeOperation("undef",ode.joynatives.undef);a.addNativeOperation("throw-error",ode.joynatives.throwError);a.addNativeOperation("block",ode.joynatives.block);a.addNativeOperation("block#",ode.joynatives.blockLocation);a.addNativeOperation("map",ode.joynatives.map);a.addNativeOperation("fold",ode.joynatives.fold)};
ode.joynatives.name=function(a){var b=a.pop();b.getName?a.push(new ode.StringNode(b.getName())):b.getTypeName?a.push(new ode.StringNode(b.getTypeName())):a.expectationError("name","symbol or literal",[b])};ode.joynatives.intern=function(a){var b=a.pop();b instanceof ode.StringNode?a.push(new ode.SymbolNode(b.val)):a.expectationError("intern","string",[b])};
ode.joynatives.pred=function(a){var b=a.pop();b.toNumberValue?a.push(new ode.NumberNode(b.toNumberValue()-1)):a.expectationError("pred","number",[b])};ode.joynatives.rand=function(a){a.push(new ode.NumberNode(Math.floor(Math.random()*4294967296)+-2147483648))};
ode.joynatives.split=function(a){var b=a.pop(),c=a.pop();if(b.getNodes&&c.getNodes){var d=[],e=[];extras.each(c.getNodes(),function(c){var h=ode.joynatives.getPreservedStack_(a);a.push(c);a.push(b);ode.joynatives.i(a);var i=a.pop();ode.joynatives.restorePreservedStack_(a,h);i.toBooleanValue?i.toBooleanValue()?d.push(c):e.push(c):a.expectationError("split","boolean",[i])});a.push(new ode.ListNode(d));a.push(new ode.ListNode(e))}else a.expectationError("split","list, quote",[c,b])};
ode.joynatives.succ=function(a){var b=a.pop();b.toNumberValue?a.push(new ode.NumberNode(b.toNumberValue()+1)):a.expectationError("succ","number",[b])};ode.joynatives.div=function(a){var b=a.pop(),c=a.pop();if(c.toNumberValue&&b.toNumberValue){var d=parseInt(c.toNumberValue()/b.toNumberValue(),10),b=c.toNumberValue()%b.toNumberValue();a.push(new ode.NumberNode(d));a.push(new ode.NumberNode(b))}else a.expectationError("div","number, number",[c,b])};
ode.joynatives.rem=function(a){var b=a.pop(),c=a.pop();c.toNumberValue&&b.toNumberValue?(b=c.toNumberValue()%b.toNumberValue(),a.push(new ode.NumberNode(b))):a.expectationError("div","number, number",[c,b])};ode.joynatives.choice=function(a){var b=a.pop(),c=a.pop(),d=a.pop();d.toBooleanValue?d.toBooleanValue()?a.push(c):a.push(b):a.expectationError("choice","boolean, node, node",[d,c,b])};
ode.joynatives.and=function(a){var b=a.pop(),c=a.pop();c.toBooleanValue&&b.toBooleanValue?(c=c.toBooleanValue(),b=b.toBooleanValue(),a.push(new ode.BooleanNode(c&&b))):a.expectationError("and","boolean, boolean",[c,b])};ode.joynatives.or=function(a){var b=a.pop(),c=a.pop();c.toBooleanValue&&b.toBooleanValue?(c=c.toBooleanValue(),b=b.toBooleanValue(),a.push(new ode.BooleanNode(c||b))):a.expectationError("or","boolean, boolean",[c,b])};
ode.joynatives.xor=function(a){var b=a.pop(),c=a.pop();c.toBooleanValue&&b.toBooleanValue?(c=c.toBooleanValue(),b=b.toBooleanValue(),a.push(new ode.BooleanNode(c?!b:b))):a.expectationError("xor","boolean, boolean",[c,b])};ode.joynatives.not=function(a){var b=a.pop();b.toBooleanValue?(b=b.toBooleanValue(),a.push(new ode.BooleanNode(!b))):a.expectationError("not","boolean",[b])};
ode.joynatives.nullPredicate=function(a){var b=a.pop();b.toNumberValue?(b=b.toNumberValue(),a.push(new ode.BooleanNode(b===0))):b.getSize?a.push(new ode.BooleanNode(b.getSize()===0)):a.expectationError("null","number or aggregate",[b])};ode.joynatives.integer=function(a){var b=a.pop(),c=!1;b instanceof ode.NumberNode&&(b=b.toNumberValue(),c=b===Math.floor(b));a.push(new ode.BooleanNode(c))};
ode.joynatives.floatPredicate=function(a){var b=a.pop(),c=!1;b instanceof ode.NumberNode&&(b=b.toNumberValue(),c=b!==Math.floor(b));a.push(new ode.BooleanNode(c))};ode.joynatives.charPredicate=function(a){var b=a.pop();a.push(new ode.BooleanNode(b instanceof ode.CharacterNode))};ode.joynatives.string=function(a){var b=a.pop();a.push(new ode.BooleanNode(b instanceof ode.StringNode))};ode.joynatives.set=function(a){var b=a.pop();a.push(new ode.BooleanNode(b instanceof ode.SetNode))};
ode.joynatives.list=function(a){var b=a.pop();a.push(new ode.BooleanNode(b instanceof ode.ListNode))};ode.joynatives.logical=function(a){var b=a.pop();a.push(new ode.BooleanNode(b instanceof ode.BooleanNode))};ode.joynatives.small=function(a){var b=a.pop();b.toNumberValue?(b=b.toNumberValue(),a.push(new ode.BooleanNode(b===0||b===1))):b.getSize?(b=b.getSize(),a.push(new ode.BooleanNode(b===0||b===1))):a.expectationError("null","number or aggregate",[b])};
ode.joynatives.makeComparisonOp=function(a,b){return function(c){var d=c.pop(),e=c.pop();e.toNumberValue&&d.toNumberValue?eval(e.toNumberValue().toString()+a+d.toNumberValue().toString())?c.push(new ode.BooleanNode(!0)):c.push(new ode.BooleanNode(!1)):c.expectationError(b,"number, number",[e,d])}};
ode.joynatives.makeMathOperator=function(a,b){return function(c){var d=c.pop(),e=c.pop();e.toNumberValue&&d.toNumberValue?(d=eval(e.toNumberValue().toString()+" "+a+" "+d.toNumberValue().toString()),c.push(new ode.NumberNode(d))):c.expectationError(b,"number, number",[e,d])}};
ode.joynatives.print=function(a){var b=a.pop();b instanceof ode.NumberNode?a.print(b.toString()):b instanceof ode.ListNode?a.print(b.toString()):b instanceof ode.SymbolNode?a.print(b.toString()):a.expectationError(".","number, name, or list",[b])};ode.joynatives.dup=function(a){a.duplicate(0)};ode.joynatives.dupd=function(a){a.duplicate(1);a.moveToTop(1)};ode.joynatives.dupLocation=function(a){var b=a.pop();b.toNumberValue?(b=b.toNumberValue(),a.duplicate(b)):a.expectationError("dup#","number",[b])};
ode.joynatives.swap=function(a){var b=a.pop(),c=a.pop();a.push(b);a.push(c)};ode.joynatives.i=function(a){var b=a.pop();b instanceof ode.ListNode?a.runNestableNodes(b.getNodes()):a.expectationError("i","list",[b])};
ode.joynatives.ifte=function(a){var b=a.pop(),c=a.pop(),d=a.pop();extras.hasInstances(ode.ListNode,d,c,b)?(d=ode.joynatives.executeListAndPreserveStack_(a,d),d.toBooleanValue?(d.toBooleanValue()?a.push(c):a.push(b),ode.joynatives.i(a)):a.expectationError("ifte","boolean",[d])):a.expectationError("ifte","if-list, then-list, else-list",[d,c,b])};
ode.joynatives.dropLocation=function(a){var b=a.pop();if(b.toNumberValue){var c=b.toNumberValue();extras.isInteger(c)&&c>=0?a.drop(c):a.expectationError("drop#","non-negative integer",[b])}else a.expectationError("drop#","number",[b])};ode.joynatives.pop=function(a){a.pop()};ode.joynatives.dip=function(a){var b=a.pop();b instanceof ode.ListNode||a.expectationError("dip","list",[b]);var c=a.pop();a.push(b);ode.joynatives.i(a);a.push(c)};
ode.joynatives.numberPredicate=function(a){a.pop()instanceof ode.NumberNode?a.push(new ode.NumberNode(1)):a.push(new ode.NumberNode(0))};ode.joynatives.blockPredicate=function(a){a.pop()instanceof ode.ListNode?a.push(new ode.NumberNode(1)):a.push(new ode.NumberNode(0))};ode.joynatives.emptyPredicate=function(a){var b=a.pop();b instanceof ode.ListNode?b.getSize()===0?a.push(new ode.NumberNode(1)):a.push(new ode.NumberNode(0)):a.expectationError("empty?","list",[b])};
ode.joynatives.concat=function(a){var b=a.pop(),c=a.pop();c.concatenate&&c.canConcatenateWith&&c.canConcatenateWith(b)?a.push(c.concatenate(b)):a.expectationError("concat","two compatible aggregates",[c,b])};ode.joynatives.size=function(a){var b=a.pop();b.getSize?a.push(new ode.NumberNode(b.getSize())):a.expectationError("size","aggregate",[b])};
ode.joynatives.cons=function(a){var b=a.pop(),c=a.pop();b.prependNode&&b.canPrependNode&&b.canPrependNode(c)?a.push(b.prependNode(c)):a.expectationError("cons",["element","compatible aggregate"],[c,b])};ode.joynatives.swons=function(a){var b=a.pop(),c=a.pop();c.prependNode&&c.canPrependNode&&c.canPrependNode(b)?a.push(c.prependNode(b)):a.expectationError("swons",["compatible aggregate","element"],[b,c])};
ode.joynatives.uncons=function(a){var b=a.pop();b.getFirst&&b.getRest&&b.getSize?(b.getSize()===0&&a.expectationError("uncons",["non-empty aggregate"],[b]),a.push(b.getFirst()),a.push(b.getRest())):a.expectationError("uncons",["aggregate"],[b])};ode.joynatives.first=function(a){var b=a.pop();b.getFirst&&b.getSize?(b.getSize()===0&&a.expectationError("first",["non-empty aggregate"],[b]),a.push(b.getFirst())):a.expectationError("first",["aggregate"],[b])};
ode.joynatives.rest=function(a){var b=a.pop();b.getRest&&b.getSize?(b.getSize()===0&&a.expectationError("rest",["non-empty aggregate"],[b]),a.push(b.getRest())):a.expectationError("rest",["aggregate"],[b])};ode.joynatives.block=function(a){a.runCreateList(1)};
ode.joynatives.blockLocation=function(a){var b=a.pop();if(b.toNumberValue){var c=b.toNumberValue();extras.isInteger(c)&&c>=0?a.runCreateList(c):a.expectationError("block#","non-negative integer",[b])}else a.expectationError("block#","number",[b])};ode.joynatives.makeRotationOp=function(a){return function(b){extras.each(a,function(a){b.moveToTop(a)})}};
ode.joynatives.infra=function(a){var b=a.pop(),c=a.pop();extras.hasInstances(ode.ListNode,b,c)?(a.enterFrame(),c=extras.reverseArray(c.getNodes()),extras.each(c,function(b){a.push(b)}),a.push(b),ode.joynatives.i(a),b=extras.reverseArray(a.getStackNodes()),a.exitFrame(),a.push(new ode.ListNode(b))):a.expectationError("infra","list, quote",[c,b])};
ode.joynatives.type=function(a){var b=a.pop();b instanceof ode.SymbolNode?a.push(new ode.ListNode([new ode.SymbolNode("name")])):b instanceof ode.NumberNode?a.push(new ode.ListNode([new ode.SymbolNode("number")])):b instanceof ode.ListNode?a.push(new ode.ListNode([new ode.SymbolNode("list")])):a.push(new ode.ListNode([new ode.SymbolNode("?")]))};
ode.joynatives.body=function(a){var b=a.pop(),c;extras.hasInstances(ode.ListNode,b)?(b.getSize()!==1&&a.expectationError("body","name in a list",[b]),c=b.getNodes()[0],extras.hasInstances(ode.SymbolNode,c)||a.expectationError("body","name in list",[b])):extras.hasInstances(ode.SymbolNode,b)?c=b:a.expectationError("body","name or name in list",[c]);b=a.symbolTable.get(c.toString());b=b instanceof ode.CustomDefinitionBody?new ode.ListNode(b.phraseNode.getNodes()):b instanceof ode.NativeDefinitionBody?
new ode.ListNode([new ode.SymbolNode("native")]):new ode.ListNode([new ode.SymbolNode("unknown")]);a.push(b)};
ode.joynatives.primrec=function(a){var b=a.pop(),c=a.pop();if(extras.hasInstances(ode.ListNode,b,c)){var d=a.pop();if(d.toNumberValue){d=d.toNumberValue();a.push(c);ode.joynatives.i(a);for(c=d;c>0;c--)a.push(new ode.NumberNode(c)),ode.joynatives.swap(a),a.push(b),ode.joynatives.i(a)}else d.getNodes?(d=extras.reverseArray(d.getNodes()),a.push(c),ode.joynatives.i(a),extras.each(d,function(c){a.push(c);ode.joynatives.swap(a);a.push(b);ode.joynatives.i(a)})):a.expectationError("primrec","number or list, list, list",
[d,c,b])}else a.expectationError("primrec","list, list",[c,b])};ode.joynatives.executeListAndPreserveStack_=function(a,b){ode.joynatives.stack(a);var c=a.pop();a.push(b);ode.joynatives.i(a);var d=a.pop();a.push(c);ode.joynatives.unstack(a);return d};ode.joynatives.restorePreservedStack_=function(a,b){a.push(b);ode.joynatives.unstack(a)};ode.joynatives.getPreservedStack_=function(a){ode.joynatives.stack(a);return a.pop()};
ode.joynatives.genrec=function(a){var b=a.pop(),c=a.pop(),d=a.pop(),e=a.pop();if(extras.hasInstances(ode.ListNode,e,d,c,b)){var f=ode.joynatives.executeListAndPreserveStack_(a,e);f.toBooleanValue?(f.toBooleanValue()?a.push(d):(a.push(c),ode.joynatives.i(a),a.push(new ode.ListNode([e,d,c,b,new ode.SymbolNode("genrec")])),a.push(b)),ode.joynatives.i(a)):a.expectationError("genrec","if-list that generates a boolean value",[e])}else a.expectationError("genrec","if-list, then-list, else1-list, else2-list",
[e,d,c,b])};
ode.joynatives.linrec=function(a){var b=a.pop(),c=a.pop(),d=a.pop(),e=a.pop();if(extras.hasInstances(ode.ListNode,e,d,c,b)){var f=ode.joynatives.executeListAndPreserveStack_(a,e);f.toBooleanValue?(f.toBooleanValue()?a.push(d):(a.push(c),ode.joynatives.i(a),a.push(new ode.ListNode([e,d,c,b,new ode.SymbolNode("linrec")])),ode.joynatives.i(a),a.push(b)),ode.joynatives.i(a)):a.expectationError("linrec","if-list that generates a boolean value",[e])}else a.expectationError("linrec","if-list, then-list, else1-list, else2-list",[e,
d,c,b])};
ode.joynatives.binrec=function(a){var b=a.pop(),c=a.pop(),d=a.pop(),e=a.pop();if(extras.hasInstances(ode.ListNode,e,d,c,b)){var f=ode.joynatives.executeListAndPreserveStack_(a,e);f.toBooleanValue?(f.toBooleanValue()?a.push(d):(a.push(c),ode.joynatives.i(a),c=new ode.ListNode([e,d,c,b,new ode.SymbolNode("binrec")]),d=a.pop(),e=a.pop(),a.push(e),a.push(c),ode.joynatives.i(a),a.push(d),a.push(c),ode.joynatives.i(a),a.push(b)),ode.joynatives.i(a)):a.expectationError("binrec","if-list that generates a boolean value",[e])}else a.expectationError("binrec",
"if-list, then-list, else1-list, else2-list",[e,d,c,b])};ode.joynatives.map=function(a){var b=a.pop(),c=a.pop();if(extras.hasInstances(ode.ListNode,b,c)){var d=[];a.enterFrame();extras.each(c.getNodes(),function(c){a.push(c);a.push(b);ode.joynatives.i(a);extras.each(a.getStackNodes(),function(a){d.push(a)});a.emptyStack()});a.exitFrame();a.push(new ode.ListNode(d))}else a.expectationError("map","two lists",[b,c])};
ode.joynatives.makeUnary=function(a,b){return function(c){var d=c.pop();d instanceof ode.ListNode||c.expectationError(a,"list",[d]);var e=[],f=[],h;for(h=0;h<b;h++)e.unshift(c.pop());var i=ode.joynatives.getPreservedStack_(c);for(h=0;h<b;h++)c.push(e[h]),c.push(d),ode.joynatives.i(c),f.push(c.pop()),ode.joynatives.restorePreservedStack_(c,i);extras.each(f,function(a){c.push(a)})}};
ode.joynatives.fold=function(a){var b=a.pop(),c=a.pop(),d=a.pop();extras.hasInstances(ode.ListNode,b,d)?(a.enterFrame(),a.push(c),extras.each(d.getNodes(),function(c){a.push(c);a.push(b);ode.joynatives.i(a)}),c=a.getStackNodes(),a.exitFrame(),extras.each(c,function(b){a.push(b)})):a.expectationError("map","list,value,list",[d,c,b])};
ode.joynatives.def=function(a){var b=a.pop(),c=a.pop();extras.hasInstances(ode.ListNode,b,c)||a.expectationError("def",["list","list"],[b,c]);b.getSize()!==1&&a.expectationError("def",["name in a list"],[b]);b=b.getNodes()[0];extras.hasInstances(ode.SymbolNode,b)||a.expectationError("def",["name in a list"],[b]);c=new ode.PhraseStatementNode(c.getNodes());c=new ode.CustomDefinitionBody(c);a.symbolTable.set(b.val,c)};
ode.joynatives.undef=function(a){var b=a.pop();extras.hasInstances(ode.ListNode,b)||a.expectationError("undef",["list"],[b]);b.getSize()!==1&&a.expectationError("undef",["name in a list"],[b]);b=b.getNodes()[0];extras.hasInstances(ode.SymbolNode,b)||a.expectationError("undef",["name in a list"],[b]);a.symbolTable.drop(b.val)};ode.joynatives.stack=function(a){var b=new ode.ListNode(extras.reverseArray(a.getStackNodes()));a.push(b)};
ode.joynatives.unstack=function(a){var b=a.pop();extras.hasInstances(ode.ListNode,b)||a.expectationError("unstack","list",[b]);a.setStackNodes(extras.reverseArray(b.getNodes()))};ode.joynatives.newstack=function(a){a.emptyStack()};ode.joynatives.throwError=function(){throw new ode.RuntimeCustomException;};ode.Controller=function(a,b,c,d,e,f){this.outputFun=a;this.errorFun=b||a;this.stack=c||new ode.RuntimeStack;this.symbolTable=d||new ode.SymbolTable;this.parser=e||new ode.Parser;this.interpreter=f||new ode.Interpreter(this.stack,this.symbolTable,this.outputFun);ode.joynatives.initialize(this.interpreter)};
ode.Controller.prototype.exec=function(a){try{this.execNoErrorHandling(a)}catch(b){b instanceof ode.LexingException?this.errorFun("Lexing error: "+b.toString()):b instanceof ode.ParsingException?this.errorFun("Parsing error: "+b.toString()):b instanceof ode.RuntimeException?this.errorFun("Runtime error: "+b.toString()):b instanceof ode.TailCallbackException?this.errorFun("Runtime error: 'self' used outside of definition"):(a="Error",b instanceof Error?(a="JavaScript Error",typeof b.name!=="undefined"&&
b.name.length>0&&(a+="\n  Name: "+b.name),typeof b.message!=="undefined"&&b.message.length>0&&(a+="\n  Message: "+b.message),typeof b.description!=="undefined"&&b.description.length>0&&(a+="\n  Description: "+b.description),typeof b.number!=="undefined"&&b.number.length>0&&(a+="\n  Error Number: "+b.number)):a="Unrecognized Error:"+b.toString(),this.errorFun(a))}};ode.Controller.prototype.execNoErrorHandling=function(a){this.interpreter.run(this.parser.parse(new ode.Lexer(a)))};
ode.Controller.prototype.emptyStack=function(){this.stack.empty()};ode.Controller.prototype.emptyCustomDefinitions=function(){this.symbolTable.emptyCustomDefinitions()};ode.Controller.prototype.stringifyStack=function(){return this.stack.toString()};ode.Controller.prototype.stringifyCustomDefinitions=function(a){return this.symbolTable.stringifyCustomDefinitions(a||" ")};ode.Controller.prototype.getAuthorInfo=function(){return"Kevin P. Albrecht"};ode.Controller.prototype.getVersionInfo=function(){return"Ode v0.4.0dev"};
